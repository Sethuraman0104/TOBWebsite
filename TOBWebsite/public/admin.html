<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">TOB - Admin</title>
  <link rel="icon" type="image/png" href="images/TOBLogoHeader.png">
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https: data:;">
</head>

<body>
  <!-- Top Bar -->
  <header class="topbar">
    <div class="topbar-left">
      <img src="images/TOBTransparent.png" alt="Logo" class="topbar-logo">
      <h1>Times of Bahrain - Admin Console</h1>
    </div>
    <div class="topbar-right">
      <span id="welcomeUser">Welcome, ...</span>
      <input type="text" id="newsSearch" placeholder="Search news...">
      <button id="logoutBtn"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
    </div>
  </header>

  <aside class="sidebar">
    <div class="sidebar-logo">
      <img src="images/TOBTransparent.png" alt="Logo">
    </div>
    <hr class="logo-divider">
    <nav class="menu">
      <ul>
        <li class="active" data-section="publish"><i class="fa-solid fa-pen-to-square"></i> Create News</li>
        <li data-section="pending"><i class="fa-solid fa-hourglass-half"></i> Unpublished News</li>
        <li data-section="allnews"><i class="fa-solid fa-newspaper"></i> Published News</li>
        <li data-section="inactive"><i class="fa-solid fa-ban"></i> Deactivated News</li>
        <li data-section="trending"><i class="fa-solid fa-fire"></i> Manage Trending</li>
        <li data-section="comments"><i class="fa-solid fa-comments"></i>Article Comments</li>
        <li data-section="trendcomments"><i class="fa-solid fa-comments"></i>Trending Article Comments</li>
        <li data-section="managecategories"><i class="fa-solid fa-screwdriver-wrench"></i> Manage Categories</li>
        <li data-section="profile"><i class="fa-solid fa-user"></i> Profile</li>
        <li data-section="managesubscribers"><i class="fa-solid fa-users"></i> Subscribers</li>
      </ul>
    </nav>
    <div class="sidebar-footer">
      <div id="lastLoginDisplay"></div>
      <div id="currentDateTime"></div>
      <div>¬© Times of Bahrain | Created by HR Info</div>
    </div>
  </aside>

  <main class="main-content">
    <!-- Publish News -->

    <section id="publish" class="section active publishNA-section">
      <div class="floating-title">üìù Create News</div>
      <div class="card form-card publishNA-form-card">
        <form id="postNewsForm" enctype="multipart/form-data">

          <label>Title (English)</label>
          <input type="text" name="Title" required>

          <label>Title (Arabic)</label>
          <input type="text" name="Title_Ar">

          <label>Content (English)</label>
          <textarea name="Content" required></textarea>

          <label>Content (Arabic)</label>
          <textarea name="Content_Ar"></textarea>

          <label>Category</label>
          <select name="CategoryID" id="createCategorySelect" class="custom-dropdown" required>
            <option value="">-- Select Category --</option>
          </select>

          <label>Main Slide Image</label>
          <input type="file" name="MainImage" accept="image/*">

          <!-- HTML Part -->
          <label>Additional Attachments</label>
          <div style="display: flex; gap: 10px; align-items: center;">
            <input type="file" id="singleAttachmentInput" accept=".bmp,.png,.jpg,.jpeg,.gif,.pdf">
            <button type="button" id="addAttachmentBtn">Add Attachment</button>
          </div>

          <table id="attachmentsTable" border="1" style="margin-top: 10px; width: 100%; border-collapse: collapse;">
            <thead>
              <tr>
                <th>#</th>
                <th>File Name</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <!-- Added attachments will appear here -->
            </tbody>
          </table>

          <label><input type="checkbox" name="IsTopStory" value="true"> Top Story</label>
          <label><input type="checkbox" name="IsFeatured" value="true"> Featured</label>
          <label><input type="checkbox" name="IsBreakingNews" value="true"> Breaking News</label>
          <label><input type="checkbox" name="IsSpotlightNews" value="true"> Spotlight</label>

          <button type="submit">Post News</button>
        </form>

        <div id="postNewsMsg" class="message"></div>
      </div>
    </section>

    <!-- Pending News -->
    <section id="pending" class="section">
      <div class="floating-title">‚è≥ Unpublished News</div>
      <div id="pendingNewsContainer"></div>
    </section>

    <!-- News Preview Modal -->
<div id="newsPreviewModal" class="preview-modal">
  <div class="preview-modal-content">

    <!-- Header -->
    <div class="preview-header">
      <h2 id="previewTitleEnHeader">English Title</h2>
      <span class="preview-close" id="closeNewsPreview">&times;</span>
    </div>

    <!-- Scrollable Content -->
    <div class="preview-scrollable">

      <!-- Carousel Container -->
      <div class="carousel-container">
        <button class="carousel-btn left" id="carouselPrev">&#10094;</button>
        <img id="carouselImage" class="carousel-image" />
        <button class="carousel-btn right" id="carouselNext">&#10095;</button>
      </div>

      <!-- Content -->
      <div class="preview-body">
        <div class="preview-left">
          <h3>English Content</h3>
          <div id="previewContentEn"></div>
        </div>
        <div class="preview-right" dir="rtl">
          <h3>Arabic Content</h3>
          <div id="previewContentAr"></div>
        </div>
      </div>

    </div>

    <!-- Footer -->
    <div class="preview-footer">
      <button id="closeNewsPreviewFooter" class="btn-close-modal">Close</button>
    </div>

  </div>
</div>


    <!-- All Published News -->
    <section id="allnews" class="section">
      <div class="floating-title">üìÑ Published News</div>
      <div class="filter-card">
        <label>Month: <input type="month" id="filterMonth"></label>
        <button id="applyFilter"><i class="fa fa-filter"></i> Apply</button>
      </div>
      <div id="allNewsEngagement"></div>
    </section>

    <section id="inactive" class="section">
      <div class="floating-title">
        üö´ Deactivated News
      </div>
      <div id="inactiveNewsContainer"></div>
    </section>

    <!-- Trending Section -->
    <section id="trending" class="section">
      <div class="floating-title">
        üî• Manage Trending Cards
      </div>

      <div class="top-actions"
        style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0;">
        <div class="filter-card" style="display: flex; gap: 10px; align-items: center;">
          <label>Month:</label>
          <input type="month" id="filterTrendMonth">
          <label>Status:</label>
          <select id="filterTrendStatus">
            <option value="all">All</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
          <button id="applyTrendFilter" class="btn btn-secondary"><i class="fa fa-filter"></i> Apply</button>
        </div>

        <button id="addTrendBtn" class="btn btn-primary" style="padding: 8px 16px;">
          <i class="fa-solid fa-plus"></i> Add New Trend
        </button>
      </div>

      <div id="trendsContainer" class="trends-grid"></div>
    </section>

    <!-- Trend Preview Modal -->
    <div id="trendsmdl-modal" class="trendsmdl-overlay">
      <div class="trendsmdl-box">
        <!-- FIXED HEADER -->
        <div class="trendsmdl-header">
          <h2 id="trendsmdl-title-en"></h2>
          <button id="trendsmdl-close-top" class="trendsmdl-close-btn">&times;</button>
        </div>

        <!-- SCROLLABLE CONTENT -->
        <div class="trendsmdl-content">
          <!-- Image -->
          <div class="trendsmdl-img-wrapper">
            <img id="trendsmdl-image" class="trendsmdl-image" />
          </div>

          <!-- Content Columns -->
          <div class="trendsmdl-row">
            <!-- English -->
            <div class="trendsmdl-col">
              <h3>English</h3>
              <div id="trendsmdl-desc-en" class="trendsmdl-text"></div>
            </div>

            <!-- Arabic -->
            <div class="trendsmdl-col" dir="rtl">
              <h3>ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</h3>
              <div id="trendsmdl-desc-ar" class="trendsmdl-text"></div>
            </div>
          </div>

          <!-- Bottom Close Button -->
          <button id="trendsmdl-close-bottom" class="trendsmdl-bottom-close">Close</button>
        </div>
      </div>
    </div>

    <!-- Comments -->
    <section id="comments" class="section">
      <div class="floating-title">
        üí¨ Article Comments Management
      </div>
      <div id="articlesWithComments" class="articles-grid"></div>
    </section>

    <!-- =================================== -->
    <!-- Trends Comments Management Section -->
    <!-- =================================== -->
    <section id="trendcomments" class="section">
      <div class="floating-title">
        üí¨ Trends Comments Management
      </div>

      <!-- Container for all trends -->
      <div id="trendsWithComments" class="articles-grid"></div>
    </section>

    <!-- Manage Categories -->
    <section id="managecategories" class="section container py-4">
      <div class="floating-title">üóÇÔ∏è Manage Categories
        <button id="addCategoryBtn" class="btn-theme">
          <i class="fa-solid fa-plus"></i> Add New Category
        </button>
      </div>

      <!-- Search Input -->
      <div class="mb-3">
        <input type="text" id="categorySearch" class="form-control" placeholder="Search categories...">
      </div>

      <!-- Grid / Table -->
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle" id="categoriesTable">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Category Name (EN)</th>
              <th>Category Name (AR)</th>
              <th>Description (EN)</th>
              <th>Description (AR)</th>
              <th>Active</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Pagination -->
      <nav>
        <ul class="pagination justify-content-center" id="categoryPagination"></ul>
      </nav>
    </section>

    <!-- Category Modal -->
    <div class="modal fade" id="categoryModal" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content p-3">
          <div class="modal-header">
            <h5 id="categoryModalTitle" class="modal-title">Add Category</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="categoryForm" class="p-2">
            <input type="hidden" id="CategoryID">
            <div class="row mb-3">
              <div class="col-md-6">
                <label>Category Name (English)</label>
                <input type="text" id="CategoryName" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label>Category Name (Arabic)</label>
                <input type="text" id="CategoryName_Ar" class="form-control">
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label>Description (English)</label>
                <textarea id="Description" class="form-control"></textarea>
              </div>
              <div class="col-md-6">
                <label>Description (Arabic)</label>
                <textarea id="Description_Ar" class="form-control"></textarea>
              </div>
            </div>
            <div class="form-check mb-3">
              <input type="checkbox" class="form-check-input" id="categoryIsActive" checked>
              <label class="form-check-label" for="IsActive">Active</label>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-success">
                <i class="fa fa-save"></i> Save
              </button>
              <button type="button" class="btn btn-secondary" id="closeCategoryModalFooter">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <section id="profile" class="section container py-4">
      <div class="floating-title">üë§ Profile</div>
      <div class="profile-card">
        <div class="profile-header">
          <h2>Profile</h2>
          <button type="button" id="openChangePasswordBtn" class="btn btn-secondary">Change Password</button>
        </div>

        <form id="profileForm" class="profile-form">
          <div class="form-group">
            <label for="profileFullName">Full Name</label>
            <input type="text" id="profileFullName" name="FullName" required>
          </div>

          <div class="form-group">
            <label for="profileEmail">Email</label>
            <input type="email" id="profileEmail" name="Email" required>
          </div>

          <div class="form-footer">
            <span id="profileMsg" class="text-success"></span>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </section>

    <!-- Manage Subscribers -->
    <section id="managesubscribers" class="section container py-4">
      <div class="floating-title">
        üìß Newsletter Subscribers
      </div>

      <!-- Search Bar -->
      <div class="mb-3">
        <input type="text" id="subscriberSearch" class="form-control" placeholder="Search subscribers...">
      </div>

      <!-- Table -->
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle" id="subscribersTable">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Email</th>
              <th>Subscribed On</th>
              <th>Confirmed</th>
              <th>Active</th>
              <th>Unsubscribed On</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Pagination -->
      <nav>
        <ul class="pagination justify-content-center" id="subscriberPagination"></ul>
      </nav>
    </section>

    <!-- Comments Modal Custom -->
    <div id="commentsModalCustom" class="modal">
      <div class="modal-content">
        <span id="closeCommentsModal" class="close">&times;</span>
        <h2 id="modalArticleTitle">Comments</h2>

        <!-- Tabs -->
        <ul class="nav-tabs">
          <li><button class="tablink active" data-tab="pendingTab">üïì Pending</button></li>
          <li><button class="tablink" data-tab="approvedTab">‚úÖ Approved</button></li>
          <li><button class="tablink" data-tab="rejectedTab">üö´ Rejected</button></li>
        </ul>

        <!-- Search -->
        <input type="text" id="commentSearch" placeholder="Search comments..."
          style="margin:10px 0; padding:5px; width:100%;">

        <!-- Tab Content -->
        <div id="tabContent">
          <div id="pendingTab" class="tab-pane active">
            <div class="table-responsive">
              <table class="table" id="pendingCommentsTable">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Comment</th>
                    <th>Commented On</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <ul class="pagination" id="pendingPagination"></ul>
          </div>
          <div id="approvedTab" class="tab-pane">
            <div class="table-responsive">
              <table class="table" id="approvedCommentsTable">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Comment</th>
                    <th>Commented On</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <ul class="pagination" id="approvedPagination"></ul>
          </div>
          <div id="rejectedTab" class="tab-pane">
            <div class="table-responsive">
              <table class="table" id="rejectedCommentsTable">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Comment</th>
                    <th>Commented On</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <ul class="pagination" id="rejectedPagination"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- =================================== -->
    <!-- Trends Comments Modal Custom -->
    <!-- =================================== -->
    <div id="trendsCommentsModalCustom" class="modal">
      <div class="modal-content">
        <span id="closeTrendsCommentsModal" class="close">&times;</span>
        <h2 id="modalTrendTitle">Comments</h2>

        <!-- Tabs -->
        <ul class="nav-tabs">
          <li><button class="tablink active" data-tab="trendsPendingTab">üïì Pending</button></li>
          <li><button class="tablink" data-tab="trendsApprovedTab">‚úÖ Approved</button></li>
          <li><button class="tablink" data-tab="trendsRejectedTab">üö´ Rejected</button></li>
        </ul>

        <!-- Search -->
        <input type="text" id="trendsCommentSearch" placeholder="Search comments..."
          style="margin:10px 0; padding:5px; width:100%;">

        <!-- Tab Content -->
        <div id="trendsTabContent">
          <!-- Pending -->
          <div id="trendsPendingTab" class="tab-pane active">
            <div class="table-responsive">
              <table class="table" id="trendsPendingCommentsTable">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Comment</th>
                    <th>Commented On</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <ul class="pagination" id="trendsPendingPagination"></ul>
          </div>

          <!-- Approved -->
          <div id="trendsApprovedTab" class="tab-pane">
            <div class="table-responsive">
              <table class="table" id="trendsApprovedCommentsTable">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Comment</th>
                    <th>Commented On</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <ul class="pagination" id="trendsApprovedPagination"></ul>
          </div>

          <!-- Rejected -->
          <div id="trendsRejectedTab" class="tab-pane">
            <div class="table-responsive">
              <table class="table" id="trendsRejectedCommentsTable">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Comment</th>
                    <th>Commented On</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <ul class="pagination" id="trendsRejectedPagination"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit Trend Modal -->
    <div id="trendModal" class="modal">
      <div class="modal-content">
        <span id="closeTrendModal" class="close">&times;</span>
        <h2 id="trendModalTitle">Add Trend</h2>
        <form id="trendForm" enctype="multipart/form-data">
          <input type="hidden" id="TrendID" name="TrendID">

          <label>Title (English)</label>
          <input type="text" name="TrendTitle_EN" id="TrendTitle_EN" required>

          <label>Title (Arabic)</label>
          <input type="text" name="TrendTitle_AR" id="TrendTitle_AR">

          <label>Description (English)</label>
          <textarea name="TrendDescription_EN" id="TrendDescription_EN"></textarea>

          <label>Description (Arabic)</label>
          <textarea name="TrendDescription_AR" id="TrendDescription_AR"></textarea>

          <label>Image</label>
          <input type="file" name="Image" id="TrendImage">

          <label>From Date</label>
          <input type="date" name="FromDate" id="FromDate" required>

          <label>To Date</label>
          <input type="date" name="ToDate" id="ToDate">

          <label><input type="checkbox" name="IsActive" id="IsActive" checked> Active</label>

          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal">
      <div class="modal-content">
        <span id="closePasswordModal" class="close">&times;</span>
        <h2>Change Password</h2>
        <form id="changePasswordForm">
          <label for="CurrentPassword">Current Password</label>
          <input type="password" id="CurrentPassword" name="CurrentPassword" required>

          <label for="NewPassword">New Password</label>
          <input type="password" id="NewPassword" name="NewPassword" required>

          <label for="ConfirmPassword">Confirm New Password</label>
          <input type="password" id="ConfirmPassword" name="ConfirmPassword" required>

          <button type="submit">Change Password</button>
          <p id="changePasswordMsg" class="msg"></p>
        </form>
      </div>
    </div>

    <div id="editModal" class="modal">
      <div class="modal-content">

        <div class="modal-header">
          <h2><i class="fa-solid fa-pen-to-square"></i> Edit News Article</h2>
          <span class="close">&times;</span>
        </div>

        <div class="modal-body">
          <form id="editNewsForm" enctype="multipart/form-data">

            <input type="hidden" name="ArticleID" id="editArticleID">

            <label>Title (English)</label>
            <input type="text" name="Title" id="editTitle">

            <label>Title (Arabic)</label>
            <input type="text" name="Title_Ar" id="editTitle_Ar">

            <label>Content (English)</label>
            <textarea name="Content" id="editContent"></textarea>

            <label>Content (Arabic)</label>
            <textarea name="Content_Ar" id="editContent_Ar"></textarea>

            <label>Category</label>
            <select name="CategoryID" id="editCategorySelect"></select>

            <label>Main Image</label>
            <div class="file-upload-box" onclick="document.getElementById('editMainImage').click()">
              <i class="fa-solid fa-image"></i><br>
              Click to select Main Image
            </div>
            <input type="file" name="MainImage" id="editMainImage" style="display:none;">
            <div id="currentImagePreview" style="margin-top:10px;"></div>

            <label>Attachments</label>

            <div class="file-upload-box" onclick="document.getElementById('editsingleAttachmentInput').click()">
              <i class="fa-solid fa-paperclip"></i><br>
              Click to add attachment
            </div>
            <input type="file" id="editsingleAttachmentInput" style="display:none;">

            <button type="button" id="editaddAttachmentBtn" class="btn-add">
              <i class="fa-solid fa-plus"></i> Add Attachment
            </button>

            <table id="editattachmentsTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Preview</th>
                  <th>File Name</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <label><input type="checkbox" style="margin-top: 10px;" name="IsTopStory" id="editIsTopStory"> Mark as Top Story</label>
            <label><input type="checkbox" name="IsFeatured" id="editIsFeatured"> Mark as Featured</label>
            <label><input type="checkbox" name="IsBreakingNews" id="editIsBreakingNews"> Mark as Breaking News</label>
            <label><input type="checkbox" name="IsSpotlightNews" id="editIsSpotlightNews"> Mark as Spotlight</label>
            <button class="btn-primary" type="submit">
              <i class="fa-solid fa-save"></i> Save Changes
            </button>
            <input type="hidden" name="editExistingAttachments" id="editExistingAttachments">
          </form>
        </div>
      </div>
    </div>


    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome (optional for icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Bootstrap Bundle JS (includes Popper.js for modals, dropdowns) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.0/moment.min.js"></script>
    <script src="js/admin.js"></script>
</body>

</html>